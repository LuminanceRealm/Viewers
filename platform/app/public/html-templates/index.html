<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no, user-scalable=no"
    />
    <meta
      name="theme-color"
      content="#000000"
    />
    <meta
      name="mobile-web-app-capable"
      content="yes"
    />
    <meta
      name="application-name"
      content="Visor | NUBIX"
    />
    <meta
      name="apple-mobile-web-app-capable"
      content="yes"
    />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta
      name="apple-mobile-web-app-title"
      content="@ohif/app"
    />
    <meta
      name="msapplication-TileColor"
      content="#fff"
    />
    <meta
      name="msapplication-TileImage"
      content="<%= PUBLIC_URL %>assets/mstile-144x144.png"
    />
    <meta
      name="msapplication-config"
      content="<%= PUBLIC_URL %>assets/browserconfig.xml"
    />
    <script type="text/javascript">
      console.time('scriptToView');
      window.PUBLIC_URL = '<%= PUBLIC_URL %>';
    </script>
    <link
      rel="manifest"
      href="<%= PUBLIC_URL %>manifest.json"
    />
    <link
      rel="shortcut icon"
      href="<%= PUBLIC_URL %>assets/nubix.png"
    />
    <!-- (otros favicons/commented out…) -->
    <link
      rel="yandex-tableau-widget"
      href="<%= PUBLIC_URL %>assets/yandex-browser-manifest.json"
    />

    <script
      rel="preload"
      as="script"
      type="text/javascript"
      src="<%= PUBLIC_URL %>app-config.js"
    ></script>
    <script
      rel="preload"
      as="script"
      type="module"
      src="<%= PUBLIC_URL %>init-service-worker.js"
    ></script>

    <title>Visor | NUBIX</title>

    <script>
      function browserImportFunction(moduleId) {
        return import(moduleId);
      }
      window.PUBLIC_URL = '<%= PUBLIC_URL %>';
    </script>
    <!-- EXTENSIONS -->
  </head>

  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="react-portal"></div>

    <!-- LOADER OVERLAY -->
    <div
      id="loading-overlay"
      style="
        position: fixed;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        background: black;
        z-index: 9999;
      "
    >
      <img
        src="<%= PUBLIC_URL %>assets/loading.gif"
        alt="Loading"
      />
    </div>

    <div id="root"></div>

    <script>
      (function () {
        var overlay = document.getElementById('loading-overlay');
        var root = document.getElementById('root');
        var minDelay = 5000; // Tiempo mínimo en ms que se mostrará el loader
        var start = Date.now();

        function hideOverlay() {
          var elapsed = Date.now() - start;
          var remaining = minDelay - elapsed;
          setTimeout(
            function () {
              overlay.style.display = 'none';
            },
            remaining > 0 ? remaining : 0
          );
        }

        // Se esconde al detectar que React monta algo en #root
        var observer = new MutationObserver(function (records) {
          if (
            records.some(function (r) {
              return r.addedNodes.length;
            })
          ) {
            hideOverlay();
            observer.disconnect();
          }
        });

        observer.observe(root, { childList: true });
        // O bien al cargar por completo la página
        window.addEventListener('load', hideOverlay);
      })();
    </script>
  </body>
</html>
